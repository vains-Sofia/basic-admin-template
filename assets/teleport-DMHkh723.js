import{t as e}from"./aria-CCaT2o1P.js";import{Er as t,Fr as n,Ft as r,Gr as i,Ir as a,Mi as o,Mr as s,Rr as c,X as l,Xt as u,fr as d,kr as f,ot as p,ri as m,sr as h,u as g,ui as _,vr as v,vt as y,yi as b,yt as x}from"./index-DkS91mYz.js";var S=`focus-trap.focus-after-trapped`,C=`focus-trap.focus-after-released`,w=`focus-trap.focusout-prevented`,T={cancelable:!0,bubbles:!1},E={cancelable:!0,bubbles:!1},D=`focusAfterTrapped`,O=`focusAfterReleased`,k=Symbol(`elFocusTrap`),A=m(),j=m(0),M=m(0),N=0,P=e=>{let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t=e.tagName===`INPUT`&&e.type===`hidden`;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},F=(e,t)=>{for(let n of e)if(!I(n,t))return n},I=(e,t)=>{if(getComputedStyle(e).visibility===`hidden`)return!0;for(;e;){if(t&&e===t)return!1;if(getComputedStyle(e).display===`none`)return!0;e=e.parentElement}return!1},L=e=>{let t=P(e);return[F(t,e),F(t.reverse(),e)]},R=e=>e instanceof HTMLInputElement&&`select`in e,z=(t,n)=>{if(t){let r=document.activeElement;e(t,{preventScroll:!0}),M.value=window.performance.now(),t!==r&&R(t)&&n&&t.select()}};function B(e,t){let n=[...e],r=e.indexOf(t);return r!==-1&&n.splice(r,1),n}var V=()=>{let e=[];return{push:t=>{let n=e[0];n&&t!==n&&n.pause(),e=B(e,t),e.unshift(t)},remove:t=>{var n,r;e=B(e,t),(r=(n=e[0])?.resume)==null||r.call(n)}}},H=(e,t=!1)=>{let n=document.activeElement;for(let r of e)if(z(r,t),document.activeElement!==n)return},U=V(),W=()=>j.value>M.value,G=()=>{A.value=`pointer`,j.value=window.performance.now()},K=()=>{A.value=`keyboard`,j.value=window.performance.now()},q=()=>(s(()=>{N===0&&(document.addEventListener(`mousedown`,G),document.addEventListener(`touchstart`,G),document.addEventListener(`keydown`,K)),N++}),f(()=>{N--,N<=0&&(document.removeEventListener(`mousedown`,G),document.removeEventListener(`touchstart`,G),document.removeEventListener(`keydown`,K))}),{focusReason:A,lastUserFocusTimestamp:j,lastAutomatedFocusTimestamp:M}),J=e=>new CustomEvent(w,{...E,detail:e}),Y=[],X=e=>{e.code===g.esc&&Y.forEach(t=>t(e))},Z=e=>{s(()=>{Y.length===0&&document.addEventListener(`keydown`,X),r&&Y.push(e)}),f(()=>{Y=Y.filter(t=>t!==e),Y.length===0&&r&&document.removeEventListener(`keydown`,X)})};b();var Q=v({name:`ElFocusTrap`,inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:`first`}},emits:[D,O,`focusin`,`focusout`,`focusout-prevented`,`release-requested`],setup(e,{emit:n}){let r=m(),c,l,{focusReason:d}=q();Z(t=>{e.trapped&&!p.paused&&n(`release-requested`,t)});let p={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},h=t=>{if(!e.loop&&!e.trapped||p.paused)return;let{code:r,altKey:i,ctrlKey:a,metaKey:o,currentTarget:s,shiftKey:c}=t,{loop:l}=e,u=r===g.tab&&!i&&!a&&!o,f=document.activeElement;if(u&&f){let e=s,[r,i]=L(e);if(r&&i){if(!c&&f===i){let e=J({focusReason:d.value});n(`focusout-prevented`,e),e.defaultPrevented||(t.preventDefault(),l&&z(r,!0))}else if(c&&[r,e].includes(f)){let e=J({focusReason:d.value});n(`focusout-prevented`,e),e.defaultPrevented||(t.preventDefault(),l&&z(i,!0))}}else if(f===e){let e=J({focusReason:d.value});n(`focusout-prevented`,e),e.defaultPrevented||t.preventDefault()}}};a(k,{focusTrapRef:r,onKeydown:h}),i(()=>e.focusTrapEl,e=>{e&&(r.value=e)},{immediate:!0}),i([r],([e],[t])=>{e&&(e.addEventListener(`keydown`,h),e.addEventListener(`focusin`,b),e.addEventListener(`focusout`,x)),t&&(t.removeEventListener(`keydown`,h),t.removeEventListener(`focusin`,b),t.removeEventListener(`focusout`,x))});let v=e=>{n(D,e)},y=e=>n(O,e),b=t=>{let i=_(r);if(!i)return;let a=t.target,o=t.relatedTarget,s=a&&i.contains(a);e.trapped||o&&i.contains(o)||(c=o),s&&n(`focusin`,t),!p.paused&&e.trapped&&(s?l=a:z(l,!0))},x=t=>{let i=_(r);if(!(p.paused||!i))if(e.trapped){let r=t.relatedTarget;!u(r)&&!i.contains(r)&&setTimeout(()=>{if(!p.paused&&e.trapped){let e=J({focusReason:d.value});n(`focusout-prevented`,e),e.defaultPrevented||z(l,!0)}},0)}else{let e=t.target;e&&i.contains(e)||n(`focusout`,t)}};async function w(){await t();let n=_(r);if(n){U.push(p);let r=n.contains(document.activeElement)?c:document.activeElement;if(c=r,!n.contains(r)){let i=new Event(S,T);n.addEventListener(S,v),n.dispatchEvent(i),i.defaultPrevented||t(()=>{let t=e.focusStartEl;o(t)||(z(t),document.activeElement!==t&&(t=`first`)),t===`first`&&H(P(n),!0),(document.activeElement===r||t===`container`)&&z(n)})}}}function E(){let e=_(r);if(e){e.removeEventListener(S,v);let t=new CustomEvent(C,{...T,detail:{focusReason:d.value}});e.addEventListener(C,y),e.dispatchEvent(t),!t.defaultPrevented&&(d.value==`keyboard`||!W()||e.contains(document.activeElement))&&z(c??document.body),e.removeEventListener(C,y),U.remove(p),c=null,l=null}}return s(()=>{e.trapped&&w(),i(()=>e.trapped,e=>{e?w():E()})}),f(()=>{e.trapped&&E(),r.value&&=(r.value.removeEventListener(`keydown`,h),r.value.removeEventListener(`focusin`,b),r.value.removeEventListener(`focusout`,x),void 0)}),{onKeydown:h}}});function ee(e,t,n,r,i,a){return c(e.$slots,`default`,{handleKeydown:e.onKeydown})}var te=p(Q,[[`render`,ee],[`__file`,`focus-trap.vue`]]),$=y({to:{type:x([String,Object]),required:!0},disabled:Boolean}),ne=l(p(v({__name:`teleport`,props:$,setup(e){return(e,t)=>e.disabled?c(e.$slots,`default`,{key:0}):(n(),d(h,{key:1,to:e.to},[c(e.$slots,`default`)],8,[`to`]))}}),[[`__file`,`teleport.vue`]]));export{k as i,$ as n,te as r,ne as t};